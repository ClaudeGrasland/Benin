---
title: "ECOLE D'ETE CIST 2022"
subtitle: "Inventaire des données sur le Benin"
date: "`r Sys.Date()`"
author: 
 - name: Claude Grasland
   affiliation: Université de Paris (Diderot), UMR 8504 Géographie-cités, FR 2007 CIST
image: "data/figures/HDX.png"   
logo: "data/figures/HDX.png"  
output:
  rzine::readrzine:
    highlight: kate
    number_sections: true
csl: Rzine_citation.csl
bibliography: biblio.bib
nocite: |
  @*
link-citations: true
#licence: "[![licensebuttons by-sa](https://licensebuttons.net/l/by-sa/3.0/88x31.png)](https://creativecommons.org/licenses/by-sa/4.0)"
#giturl: "[![Code source on GitHub](https://badgen.net/badge/Code%20source%20on%20/GitHub/blue?icon=github)](xxx)"
#doi: "[![DOI:xxx](https://zenodo.org/badge/DOI/xxx.svg)](https://doi.org/xxx)"
---


```{r setup, include=FALSE}

library(knitr)
library(rzine)
library(sf)
library(leaflet)
library(FactoMineR)
library(mapsf)
library(data.table)
library(tidyr)
library(dplyr)
library(ggplot2)
library(cowplot)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=FALSE,
               comment=NA,
               message=FALSE,
               warning=FALSE,
               class.source="bg-info",
               class.output="bg-warning")

# opts_knit$set(width=75)
```



# Humanitarian Data Exchange

Le signe **OCHA** désigne le **United Nation Office for the Coordination of Human Affairs** dont la vocation est de fournir une aide dans les situations d'urgence. Sa mission qui est expliquée en détail sur [son site web](https://www.unocha.org/about-ocha) comporte de nombreux volets. Cette agence est organisée sur un plan régional et comporte notamment une délégation spécialisée dans les pays d'Afrique Centrale et de l'Ouest appelée **OCHA-ROWCA** qui couvre l'ensemble despays ciblés par l'école d'été du CIST.

Pour mener à bien ses actions l'OCHA-ROWCA a développé un grand nombre de bases de données qui sont mises à jour régulièrement avec un accès à première vue facile. Ces données sont accessiblesà travers la plateforme [Humanitarian Data Exchange (HDX)](https://data.humdata.org/) qui semble avoir été mise au point par OCHA. Cette plateforme HDX ne comporte pas seulement des données mais aussi différents outils de visualisation ou d'analyse. 

Cela pourrait donc constituer une source majeure de données pour l'école d'été CIST 2022-2023, mais il faut en faire un inventaire précis. L'objet de cette note est de procéder à quelques explorations préliminaires en prenant comme cible le Bénin. 




Si nous effectuons une requête `Benin`  sur le site de données HDX ce qui conduit à une liste de 25 sources de données provenant soit de OCHA-ROWCA, soit d'autres agences des Nations-Unies (FAO, WorldBank, WolrdPop, ...). On trouve encore plus de sources (environ 200) si on utilise le menu de recherche par pays car le moteur ajoute dans ce cas des bases de données transnationales. 

Le HDX est donc un véritable hub de concentration des données les plus récentes sur les pays qui nousintéressent pour l'école d'été, et pas seulement le Benin.



```{r}
knitr::include_graphics("data/figures/HDX.png")
```

Comme on ne peut tout explorer d'un coup, nous commençons par les données qui viennet à proprement parler d'OCHA-ROWCA. 



Nous procédons ci-dessous à l'inventaire des sources mises à jour pour le Benin sur HDX.

## Limites administratives en 2019

Le dossier des limites administratives du Benin ([cliquer ici](https://data.humdata.org/dataset/benin-administrative-boundaries)) est accessible au format shapefile et comporte différentes couches correspondant aux différents niveaux administratifs. Sa datation laisse augurer qu'il s'agit de la situation la plus récente: les fichiers datent de juin 2021 mais leur nom comporte la séquence "20190816" qui doit plutôt correspondre au 16 Août 2019. 

```{r, fig.width=5,fig.cap="Départements et communes du Bénin (Source : OCHA-ROWCA)"}

adm0<-st_read("data/admin/ben_admbnda_adm0_1m_salb_20190816.shp",quiet = TRUE)
adm1<-st_read("data/admin/ben_admbnda_adm1_1m_salb_20190816.shp",quiet = TRUE)
adm2<-st_read("data/admin/ben_admbnda_adm2_1m_salb_20190816.shp", quiet = TRUE)

par(mar=c(0,0,0,0))
plot(adm2$geometry,col="lightyellow", border = "gray20",lwd=0.5)
plot(adm1$geometry,col=NA, border = "red",lwd=1, add=TRUE)
plot(adm0$geometry,col=NA, border = "black",lwd=2, add=TRUE)

```
Compte tenu des fortes différences de densité de population à l'intérieur du pays, il peut s'avérer intéressant de produire des cartogrammes où la surface est déformée par la population. On peut ainsi produire à l'aide du petit logiciel [Scapetoad](http://scapetoad.choros.place/download.php) une vision un peu différente du pays où le poids démographique du sud est mis en valeur. 

```{r, fig.width=5,fig.cap="Cartogramme du Benin selon la population en 2019 (Source : OCHA-ROWCA)"}

adm2bis<-st_read("data/admin/benpop2019.shp", quiet=T)

par(mar=c(0,0,0,0))
plot(adm2bis$geometry,col="lightyellow", border = "gray20",lwd=0.5)


```




## Villages et localités vers 2015

Un autre dossier accessible en [cliquant ici](https://data.humdata.org/dataset/benin-settlements) concerne le peuplement, c'est-à-dire l'inventaire de toutes les localisations avec leur nom et leur position en latitude longitude. Il comporte 6306 entrées. Les fichiers sont datés de 2015. 

```{r, fig.width=5,fig.cap="Village et peuplement au Benin vers 2015 (Source : OCHA-ROWCA)"}
loc<-st_read("data/settlement/ben_plp_NGA.shp", quiet = TRUE)
par(mar=c(0,0,0,0))
plot(adm2$geometry,col="lightyellow", border = "gray20",lwd=0.5)
plot(loc$geometry,col="red",pch=16,cex=0.2, add=T)

```

A titre de vérification de la précision, nous effectuons une superposition sur le fonds de carte OpenStreetMap pour la commune de Ouidah (code BJ0304 ou BEN003004) ou aura lieu l'école d'été du CIST. En cliquant sur les points onpeut comparer leur nom avec celui des localités indiquées par OSM.

```{r, fig.width=5,fig.cap="Projection des données OCHA-ROWCA sur Open Street Map (commune de Ouidah"}
map<-adm2[adm2$admin2Pcod=="BJ0304",]
map<-st_transform(map,4326)

vil<-loc[loc$RowcaCode2=="BEN003004",]
vil<-st_transform(vil,4326)


map <- leaflet() %>% 
            addTiles() %>%
            setView(lat = 6.4, lng=2.1, zoom = 11) %>%
            addPolygons(data = map,
                        fill = FALSE,
                        color = "red",
                        weight = 2) %>%
             addMarkers(data = vil,
                        label = ~FULL_NAME_)

map
```

Il y a à l'évidence des décalages ... Et le contour de la commune lui-même ne semble pas coller exactement avec celui fourni par OSM. Il faudra vérifier laquelle des deux sources est erronée (à moins que ce ne soient les deux ?). Toutefois, la localisation semble rester approximativement juste ...

## Pyramide des âges 2019 (estim.)

Un dossier [accessible ici](https://data.humdata.org/dataset/benin-administrative-level-0-2-sadd-2019-projected-population-statistics) fournit les populations par âge et par sexe en 2019 au niveau des communes, départements ou pays entier. Il s'agit naturellement d'**estimations** mais les données n'en sont pas moins très utile pour toute analyse travaillant sur les situations présentes. Les classes d'âges sont suffisamment détaillées (tranches de 5 ans de 0 à 80 ans) pour procéder à des analyses démographiques intéressantes. A titre d'exemple, on réalise une AFC sur la pyramide des âges des 77 communes


```{r, fig.cap="AFC sur les structures par âge et sexe des communes du Benin en 2019 (Source : OCHA-ROWCA)"}
don<-read.table("data/pop2019/ben_adm2_pop.csv", sep=";",header=T, encoding = "UTF-8")
don2<-don[,c(11:44)]
row.names(don2)<-don$ADM2_PCODE

afc<-CA(don2,ncp = 10,graph = FALSE)
library(explor)
res <- explor::prepare_results(afc)
explor::CA_var_plot(res, xax = 1, yax = 2, lev_sup = FALSE, var_sup = FALSE,
    var_sup_choice = , var_hide = "Row", var_lab_min_contrib = 0, col_var = "Position",
    symbol_var = NULL, size_var = NULL, size_range = c(10, 300), labels_size = 10,
    point_size = 56, transitions = TRUE, labels_positions = "auto", xlim = c(-0.234,
        0.332), ylim = c(-0.187, 0.38))
```

On enchaîne par une CAH (sur les axes de l'AFC) :

```{r, fig.cap = "Type de structures par âge et sexe des communes du Benin en 2019 (source : OCHA)" }
cah <- HCPC(afc,nb.clust = 5,graph = FALSE)
plot.HCPC(cah,choice = "tree")

```



```{r, fig.cap = "Position des classes de la CAH sur les axes de l'AFC (source : OCHA)"}
plot.HCPC(cah,choice = "map", label.cex=0.3)
```

Il reste à visualiser les classes. On crée pour cela une fonction assez complexe de comparaison entre le profil de celles-ci et le profil du Bénin, inspirée d'un programme trouvé sur un [forum du CIRAD](http://forums.cirad.fr/logiciel-R/viewtopic.php?t=9381) 

```{r, fig.height=8, echo=FALSE, fig.cap = "Profils moyens des classes (source : OCHA)"}
pyrclas <- function(numclas=1) {  
ages<- data.table(cah$data.clust)
fem<-ages[,list(F_00_04 = sum(F_00_04),
                 F_05_09 = sum(F_05_09),
                 F_10_14 = sum(F_10_14),
                 F_15_19 = sum(F_15_19),
                 F_20_24 = sum(F_20_24),
                 F_25_29 = sum(F_25_29),
                 F_30_34 = sum(F_30_34),
                 F_35_39 = sum(F_35_39),
                 F_40_44 = sum(F_40_44),
                 F_45_49 = sum(F_45_49),
                 F_50_54 = sum(F_50_54),
                 F_55_59 = sum(F_55_59),
                 F_60_64 = sum(F_60_64),
                 F_65_69 = sum(F_65_69),
                 F_70_74 = sum(F_70_74),
                 F_75_79 = sum(F_75_79),
                 F_80plus = sum(F_80plus)
                 ),list(clust)]

femtot<-fem[,list(F_00_04 = sum(F_00_04),
                 F_05_09 = sum(F_05_09),
                 F_10_14 = sum(F_10_14),
                 F_15_19 = sum(F_15_19),
                 F_20_24 = sum(F_20_24),
                 F_25_29 = sum(F_25_29),
                 F_30_34 = sum(F_30_34),
                 F_35_39 = sum(F_35_39),
                 F_40_44 = sum(F_40_44),
                 F_45_49 = sum(F_45_49),
                 F_50_54 = sum(F_50_54),
                 F_55_59 = sum(F_55_59),
                 F_60_64 = sum(F_60_64),
                 F_65_69 = sum(F_65_69),
                 F_70_74 = sum(F_70_74),
                 F_75_79 = sum(F_75_79),
                 F_80plus = sum(F_80plus)
                 )]



hom<-ages[,list(M_00_04 = sum(M_00_04),
                 M_05_09 = sum(M_05_09),
                 M_10_14 = sum(M_10_14),
                 M_15_19 = sum(M_15_19),
                 M_20_24 = sum(M_20_24),
                 M_25_29 = sum(M_25_29),
                 M_30_34 = sum(M_30_34),
                 M_35_39 = sum(M_35_39),
                 M_40_44 = sum(M_40_44),
                 M_45_49 = sum(M_45_49),
                 M_50_54 = sum(M_50_54),
                 M_55_59 = sum(M_55_59),
                 M_60_64 = sum(M_60_64),
                 M_65_69 = sum(M_65_69),
                 M_70_74 = sum(M_70_74),
                 M_75_79 = sum(M_75_79),
                 M_80plus = sum(M_80plus)
                 ),list(clust)]

homtot<-hom[,list(M_00_04 = sum(M_00_04),
                 M_05_09 = sum(M_05_09),
                 M_10_14 = sum(M_10_14),
                 M_15_19 = sum(M_15_19),
                 M_20_24 = sum(M_20_24),
                 M_25_29 = sum(M_25_29),
                 M_30_34 = sum(M_30_34),
                 M_35_39 = sum(M_35_39),
                 M_40_44 = sum(M_40_44),
                 M_45_49 = sum(M_45_49),
                 M_50_54 = sum(M_50_54),
                 M_55_59 = sum(M_55_59),
                 M_60_64 = sum(M_60_64),
                 M_65_69 = sum(M_65_69),
                 M_70_74 = sum(M_70_74),
                 M_75_79 = sum(M_75_79),
                 M_80plus = sum(M_80plus)
                 )]



# Creation de la base "donnee1"
donnee1<-c(1:17)
donnee1<-as.data.frame(donnee1)
donnee1$age<-c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39",
               "40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80 et +")
donnee1$nbrM<-as.numeric(hom[numclas,2:18])
donnee1$nbrM<-100*donnee1$nbrM/sum(donnee1$nbrM)
donnee1$nbrF<-as.numeric(fem[numclas,2:18])
donnee1$nbrF<-100*donnee1$nbrF/sum(donnee1$nbrF)
Classe = donnee1

donnee2<-c(1:17)
donnee2<-as.data.frame(donnee2)
donnee2$age<-c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39",
               "40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80 et +")
donnee2$nbrM<-as.numeric(homtot)
donnee2$nbrM<-100*donnee2$nbrM/sum(donnee2$nbrM)
donnee2$nbrF<-as.numeric(femtot)
donnee2$nbrF<-100*donnee2$nbrF/sum(donnee2$nbrF)
Benin = donnee2

# Reformat data
donnee <- bind_rows(
  Classe %>% mutate(data = "Classe", Classe = NULL),
  Benin %>% mutate(data = "Benin", Benin = NULL)
) %>%
  mutate(age = factor(x = age, levels = unique(age))) %>%
  gather(key = "label", value = "nombre", nbrM, nbrF) %>%
  mutate(
    sex = factor(x = unname(c("nbrM" = "Hommes", "nbrF" = "Femmes")[label]), levels = c("Femmes", "Hommes")),
    direction = c("nbrM" = -1, "nbrF" = 1)[label],
    alpha = data
  )

g <- ggplot() +
  theme_classic() +
  geom_bar(
    data = filter(donnee, data=="Benin"),
    aes(x = age, y = nombre*direction, fill = sex, group = data, alpha = alpha),
    stat = "identity",
    width = 0.90
  ) +
  geom_bar(
    data = filter(donnee, data=="Classe"),
    aes(x = age, y = nombre*direction, fill = sex, group = data, alpha = alpha),
    stat = "identity",
    width = 0.45
  ) +
  geom_hline(yintercept = 0) +
  coord_flip() +
  scale_y_continuous(labels = function(x){paste0(abs(x), "%")}) +
  scale_alpha_manual(values = c(0.2, 1), breaks = c("Benin", "Classe")) +
  scale_fill_discrete(drop = FALSE) +
  labs(x = "Age", y = NULL, fill = "Sexe")

return(g)

}

leg <- get_legend(pyrclas(1))
p1<-pyrclas(1)+ theme(legend.position = "none")
p2<-pyrclas(2)+ theme(legend.position = "none")
p3<-pyrclas(3)+ theme(legend.position = "none")
p4<-pyrclas(4)+ theme(legend.position = "none")
p5<-pyrclas(5)+ theme(legend.position = "none")



plot_grid(p1, p2, p3, p4, p5, leg,labels = c("1", "2", "3", "4", "5",""), align = "hv",ncol=2)

```

- la **classe 1** : correspond à une population beaucoup plus jeune que la moyenne du pays avec un excédent de 0-9 ans et un déficit de 30 ans et plus. C'est la partie du pays où la transition démographique semble être la plus tardive
- la **classe 2** : présente également un profil de population jeune avec un excédent de 5-14 ans, mais se caractérise par une réduction relative des 0-4 ans qui témoigne soit d'une baisse de la fécondité, soit d'un exode rural des jeunes ménages avec enfants.
- la **classe 3** correspond au profil moyen du pays.
- la **classe 4** est caractérisée par un excédent de personnes âgées et un déficit à la fois de jeunes enfants et de jeunes adultes. Elle correspond à des zones de vieillissment relatif de la population, soit sous l'effet de l'exode rural, soit en raison d'une baisse de la fécondité.
- la **classe 5** est caractérise par une forte surreprésentation des jeunes adultes et des persones âgées, associée à un net déficit des enfants jeunes de 0 à 14 ans. Il s'agit vraisemblablement de zones urbaines caractérisées par une fécodité plus tardive et une meilleure espérance de vie.  

On peut visualiser la distribution de ces cinq classes sur une carte : 


```{r, echo=FALSE, fig.cap = "Distribution spatiale des classes (source : OCHA)"}

par(mfrow = c(1,2))


### Carte classique

adm2$clust<-cah$data.clust$clust

# set theme
mf_theme("candy")
# plot administrative status
mf_map(
  x = adm2, 
  var = "clust", 
  type = "typo",
  pal = c("red", "orange","yellow","green","blue"), 
  lwd = .5,
  leg_pos = "topright",
  leg_title = ""
)

# layout
mf_layout(title = "Carte géométrique",  
          scale = "FALSE",
          credits = paste0("Sources: OCHA, 2019\n",
                            "Ecole d'été CIST 2022"))



### Carte anamorphosée par la population


adm2bis<-st_read("data/admin/benpop2019.shp", quiet=T)
adm2bis$clust<-cah$data.clust$clust
# set theme
mf_theme("candy")
# plot administrative status
mf_map(
  x = adm2bis, 
  var = "clust", 
  type = "typo",
  pal = c("red", "orange","yellow","green","blue"), 
  lwd = .5,
  leg_pos = "topright",
  leg_title = ""
)

# layout
mf_layout(title = "Cartogramme démographique",  
          scale = "FALSE",
          credits = paste0("Sources: OCHA, 2019\n",
                            "Ecole d'été CIST 2022"))

```




## Alphabetisation et langues parlées (2013)


### Métadonnées 

Ce fichier qui est accessible sur HDX en suivant [ce lien](https://data.humdata.org/dataset/benin-languages) a été mis à disposition par l'organisation [Translators without borders](https://translatorswithoutborders.org/) mais l'analyse des métadonnées montre qu'il s'agit en fait de données extraites du recensement géénral de population du Bénin de 2013 :


> Created by Translators without Borders,  Uploaded on Jun-21, Version 1

>**Notes and caveats**

>  + All data is drawn from government survey results and is subject to any associated limitations or distortions present in the source data.
>  + Literacy was measured as the ability to read and write in any language.
Languages with population shares less than 0.01% or under 1,000 people (whichever is greater) have been aggregated into the “Other” field.
>  + All decimal values have been rounded to a maximum of 3 decimal places. As a result language shares may not total 100%.
>  + Empty values represent non-existent data and should not be treated as zero values.
Data is available under an Attribution NonCommercial ShareAlike 4.0 International license (CC BY NC SA 4.0)

>**Copyright and terms of use**

>  + You are free to share and adapt the data subject to requirements for attribution and non commercial use. 
>  + Any derivative work must be distributed under the same license as the original. Full terms at 
https://creativecommons.org/licenses/by nc sa/4.0/


### Préparation des données

Les fichiers fournies comportaient de petites erreurs ou des difficultés de formatage rendant compliquée leur importation dans R. Il a donc fallu les corriger un peu avant de les utiliser. Une fois cela effectué, on a vérifié que les données pouvaient se cartographie en effectuant une jointure avec le fichier administratif au niveau communal et en créant un fichier unique au format sf (spatial feature) pour les analyses ultérieures. 

```{r}
don<-read.table(file = "data/langues/bj_lang_adm2_correct.csv",
                sep=";",
                header =T,
                dec=",")

map <- st_read("data/admin/ben_admbnda_adm2_1m_salb_20190816.shp", quiet = TRUE) %>%    
        select(admin2_code = admin2Pcod) %>% 
        inner_join(don)

saveRDS(map,"data/langues/bj_lang_admin2_map.rda")


```





# Bibliographie {-}

<div id="refs"></div>


# Annexes {-}


## Infos session  {-}

```{r session_info, echo=FALSE}
kableExtra::kable_styling(kable(sessionRzine()[[1]], row.names = F))
kableExtra::kable_styling(kable(sessionRzine()[[2]], row.names = F))
```





## Citation {-}

```{r generateBibliography, echo=FALSE}

cat(readLines('cite.bib'), sep = '\n')

``` 

<br>

## Glossaire {- #endnotes}

```{js, echo=FALSE}

$(document).ready(function() {
  $('.footnotes ol').appendTo('#endnotes');
  $('.footnotes').remove();
});

```


