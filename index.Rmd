---
title: "ECOLE D'ETE CIST 2022"
subtitle: "Inventaire des données sur le Benin"
date: "`r Sys.Date()`"
author: 
 - name: Claude Grasland
   affiliation: Université de Paris (Diderot), UMR 8504 Géographie-cités, FR 2007 CIST
image: "data/figures/HDX.png"   
logo: "data/figures/HDX.png"  
output:
  rzine::readrzine:
    highlight: kate
    number_sections: true
csl: Rzine_citation.csl
bibliography: biblio.bib
nocite: |
  @*
link-citations: true
#licence: "[![licensebuttons by-sa](https://licensebuttons.net/l/by-sa/3.0/88x31.png)](https://creativecommons.org/licenses/by-sa/4.0)"
#giturl: "[![Code source on GitHub](https://badgen.net/badge/Code%20source%20on%20/GitHub/blue?icon=github)](xxx)"
#doi: "[![DOI:xxx](https://zenodo.org/badge/DOI/xxx.svg)](https://doi.org/xxx)"
---


```{r setup, include=FALSE}

library(knitr)
library(rzine)
library(sf)
library(leaflet)
library(FactoMineR)
library(mapsf)
library(data.table)
library(tidyr)
library(dplyr)
library(ggplot2)
library(cowplot)
library(mapview)
library(DT)
library(stargazer)


## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=FALSE,
               comment=NA,
               message=FALSE,
               warning=FALSE,
               class.source="bg-info",
               class.output="bg-warning")

# opts_knit$set(width=75)
```



# Sources

Nous inventorions ici les principales sources de données utilisables pour le Bénin ou les autres pays de la formation.

## Humanitarian Data Exchange (HDX)

Il s'agit d'une source majeure qui semble utilisable dans tous les pays. 

### OCHA

Le sigle **OCHA** désigne le **United Nation Office for the Coordination of Human Affairs** dont la vocation est de fournir une aide dans les situations d'urgence. Sa mission qui est expliquée en détail sur [son site web](https://www.unocha.org/about-ocha) comporte de nombreux volets. Cette agence est organisée sur un plan régional et comporte notamment une délégation spécialisée dans les pays d'Afrique Centrale et de l'Ouest appelée **OCHA-ROWCA** qui couvre l'ensemble despays ciblés par l'école d'été du CIST.


### HDX

Pour mener à bien ses actions l'OCHA-ROWCA a développé un grand nombre de bases de données qui sont mises à jour régulièrement avec un accès à première vue facile. Ces données sont accessiblesà travers la plateforme [Humanitarian Data Exchange (HDX)](https://data.humdata.org/) qui semble avoir été mise au point par OCHA. Cette plateforme HDX ne comporte pas seulement des données mais aussi différents outils de visualisation ou d'analyse. 

Cela pourrait donc constituer une source majeure de données pour l'école d'été CIST 2022-2023, mais il faut en faire un inventaire précis. L'objet de cette note est de procéder à quelques explorations préliminaires en prenant comme cible le Bénin. 


Si nous effectuons une requête `Benin`  sur le site de données HDX ce qui conduit à une liste de 142 sources de données provenant soit de OCHA-ROWCA, soit d'autres agences des Nations-Unies (FAO, WorldBank, WolrdPop, ...). On trouve encore plus de sources (environ 200) si on utilise le menu de recherche par pays car le moteur ajoute dans ce cas des bases de données transnationales. 

Le HDX est donc un véritable hub de concentration des données les plus récentes sur les pays qui nousintéressent pour l'école d'été, et pas seulement le Benin.



```{r}
knitr::include_graphics("data/figures/HDX.png")
```

Comme on ne peut tout explorer d'un coup, nous commençons par les données qui viennet à proprement parler d'OCHA-ROWCA. 


# Données 

Dans cette section nous proposons de rassembler des tableaux de données harmonisées en vue de l'école d'été CIST 2022. Nous privilégions l'exemple du Bénin qui sera le lieu de la formation. Chaque tableau de données fait l'objet d'un exemple rapide d'application de méthodes statistiques ou carographiques afin de vérifier la fiabilité et la qualité des données 

## Limites administratives 

Le dossier des limites administratives du Benin fourni par HDX ([cliquer ici](https://data.humdata.org/dataset/benin-administrative-boundaries)) est accessible au format shapefile et comporte différentes couches correspondant aux différents niveaux administratifs. Sa datation laisse augurer qu'il s'agit de la situation la plus récente: les fichiers datent de juin 2021 mais leur nom comporte la séquence "20190816" qui doit plutôt correspondre au 16 Août 2019. En pratique, les limites sont celles du recensement de 2013. 

**N.B.** nous avons toutefois découvert une erreur importante dans le code de la commune d'Adjara qui est noté *BJ0101* alors que le code exact est *BJ1001*. Nous avons également constaté une variabilité des noms de vraiables désignant les codes dans la base OCHA. C'est pourquoi nous avons préféré harmoniser les fichiers. 

```{r, fig.width=5,fig.cap="Départements et communes du Bénin (Source : OCHA-ROWCA)"}

adm0<-st_read("data/admin/ben_adm0.shp",quiet = TRUE)
adm1<-st_read("data/admin/ben_adm1.shp",quiet = TRUE)
adm2<-st_read("data/admin/ben_adm2.dbf", quiet = TRUE)

```


On peut vérifier la qualité des fichiers en effectuant un calage sur OpenStreetMap à l'aide du package `leaflet` : 


```{r, fig.width=5,fig.cap="Superposition des fonds de carte sur OSM"}



map <- leaflet() %>% 
            addTiles() %>%
            setView(lat = 8, lng=2.1, zoom = 6) %>%
              addPolygons(data = adm2,
                          label = ~ADM2_NAME,
                          highlightOptions = TRUE,
                           fill = TRUE,
                           color = "orange",
                           weight = 3 ) %>%
             addPolygons(data = adm1,
                        fill = FALSE,
                        color = "red",
                        weight = 2) %>%
             addPolygons(data = adm0,
                        fill = FALSE,
                        color = "black",
                        weight = 1) 
  

map
```



## Pyramide des âges 2019 

Un dossier du HDX [accessible ici](https://data.humdata.org/dataset/benin-administrative-level-0-2-sadd-2019-projected-population-statistics) fournit les populations par âge et par sexe en 2019 au niveau des communes, départements ou pays entier. Il s'agit naturellement d'**estimations** mais les données n'en sont pas moins très utile pour toute analyse travaillant sur les situations présentes. Les classes d'âges sont suffisamment détaillées (tranches de 5 ans de 0 à 80 ans) pour procéder à des analyses démographiques intéressantes. A titre d'exemple, on réalise une AFC sur la pyramide des âges des 77 communes


```{r, fig.cap="AFC sur les structures par âge et sexe des communes du Benin en 2019 (Source : OCHA-ROWCA)"}
don<-read.table("data/pop2019/ben_adm2_pop.csv", sep=";",header=T, encoding = "UTF-8")
don2<-don[,c(11:44)]
row.names(don2)<-don$ADM2_PCODE

afc<-CA(don2,ncp = 10,graph = FALSE)
library(explor)
res <- explor::prepare_results(afc)
explor::CA_var_plot(res, xax = 1, yax = 2, lev_sup = FALSE, var_sup = FALSE,
    var_sup_choice = , var_hide = "Row", var_lab_min_contrib = 0, col_var = "Position",
    symbol_var = NULL, size_var = NULL, size_range = c(10, 300), labels_size = 10,
    point_size = 56, transitions = TRUE, labels_positions = "auto", xlim = c(-0.234,
        0.332), ylim = c(-0.187, 0.38))
```

On enchaîne par une CAH (sur les axes de l'AFC) :

```{r, fig.cap = "Type de structures par âge et sexe des communes du Benin en 2019 (source : OCHA)" }
cah <- HCPC(afc,nb.clust = 5,graph = FALSE)
plot.HCPC(cah,choice = "tree")

```



```{r, fig.cap = "Position des classes de la CAH sur les axes de l'AFC (source : OCHA)"}
plot.HCPC(cah,choice = "map", label.cex=0.3)
```

Il reste à visualiser les classes. On crée pour cela une fonction assez complexe de comparaison entre le profil de celles-ci et le profil du Bénin, inspirée d'un programme trouvé sur un [forum du CIRAD](http://forums.cirad.fr/logiciel-R/viewtopic.php?t=9381) 

```{r, fig.height=8, echo=FALSE, fig.cap = "Profils moyens des classes (source : OCHA)"}
pyrclas <- function(numclas=1) {  
ages<- data.table(cah$data.clust)
fem<-ages[,list(F_00_04 = sum(F_00_04),
                 F_05_09 = sum(F_05_09),
                 F_10_14 = sum(F_10_14),
                 F_15_19 = sum(F_15_19),
                 F_20_24 = sum(F_20_24),
                 F_25_29 = sum(F_25_29),
                 F_30_34 = sum(F_30_34),
                 F_35_39 = sum(F_35_39),
                 F_40_44 = sum(F_40_44),
                 F_45_49 = sum(F_45_49),
                 F_50_54 = sum(F_50_54),
                 F_55_59 = sum(F_55_59),
                 F_60_64 = sum(F_60_64),
                 F_65_69 = sum(F_65_69),
                 F_70_74 = sum(F_70_74),
                 F_75_79 = sum(F_75_79),
                 F_80plus = sum(F_80plus)
                 ),list(clust)]

femtot<-fem[,list(F_00_04 = sum(F_00_04),
                 F_05_09 = sum(F_05_09),
                 F_10_14 = sum(F_10_14),
                 F_15_19 = sum(F_15_19),
                 F_20_24 = sum(F_20_24),
                 F_25_29 = sum(F_25_29),
                 F_30_34 = sum(F_30_34),
                 F_35_39 = sum(F_35_39),
                 F_40_44 = sum(F_40_44),
                 F_45_49 = sum(F_45_49),
                 F_50_54 = sum(F_50_54),
                 F_55_59 = sum(F_55_59),
                 F_60_64 = sum(F_60_64),
                 F_65_69 = sum(F_65_69),
                 F_70_74 = sum(F_70_74),
                 F_75_79 = sum(F_75_79),
                 F_80plus = sum(F_80plus)
                 )]



hom<-ages[,list(M_00_04 = sum(M_00_04),
                 M_05_09 = sum(M_05_09),
                 M_10_14 = sum(M_10_14),
                 M_15_19 = sum(M_15_19),
                 M_20_24 = sum(M_20_24),
                 M_25_29 = sum(M_25_29),
                 M_30_34 = sum(M_30_34),
                 M_35_39 = sum(M_35_39),
                 M_40_44 = sum(M_40_44),
                 M_45_49 = sum(M_45_49),
                 M_50_54 = sum(M_50_54),
                 M_55_59 = sum(M_55_59),
                 M_60_64 = sum(M_60_64),
                 M_65_69 = sum(M_65_69),
                 M_70_74 = sum(M_70_74),
                 M_75_79 = sum(M_75_79),
                 M_80plus = sum(M_80plus)
                 ),list(clust)]

homtot<-hom[,list(M_00_04 = sum(M_00_04),
                 M_05_09 = sum(M_05_09),
                 M_10_14 = sum(M_10_14),
                 M_15_19 = sum(M_15_19),
                 M_20_24 = sum(M_20_24),
                 M_25_29 = sum(M_25_29),
                 M_30_34 = sum(M_30_34),
                 M_35_39 = sum(M_35_39),
                 M_40_44 = sum(M_40_44),
                 M_45_49 = sum(M_45_49),
                 M_50_54 = sum(M_50_54),
                 M_55_59 = sum(M_55_59),
                 M_60_64 = sum(M_60_64),
                 M_65_69 = sum(M_65_69),
                 M_70_74 = sum(M_70_74),
                 M_75_79 = sum(M_75_79),
                 M_80plus = sum(M_80plus)
                 )]



# Creation de la base "donnee1"
donnee1<-c(1:17)
donnee1<-as.data.frame(donnee1)
donnee1$age<-c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39",
               "40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80 et +")
donnee1$nbrM<-as.numeric(hom[numclas,2:18])
donnee1$nbrM<-100*donnee1$nbrM/sum(donnee1$nbrM)
donnee1$nbrF<-as.numeric(fem[numclas,2:18])
donnee1$nbrF<-100*donnee1$nbrF/sum(donnee1$nbrF)
Classe = donnee1

donnee2<-c(1:17)
donnee2<-as.data.frame(donnee2)
donnee2$age<-c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39",
               "40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80 et +")
donnee2$nbrM<-as.numeric(homtot)
donnee2$nbrM<-100*donnee2$nbrM/sum(donnee2$nbrM)
donnee2$nbrF<-as.numeric(femtot)
donnee2$nbrF<-100*donnee2$nbrF/sum(donnee2$nbrF)
Benin = donnee2

# Reformat data
donnee <- bind_rows(
  Classe %>% mutate(data = "Classe", Classe = NULL),
  Benin %>% mutate(data = "Benin", Benin = NULL)
) %>%
  mutate(age = factor(x = age, levels = unique(age))) %>%
  gather(key = "label", value = "nombre", nbrM, nbrF) %>%
  mutate(
    sex = factor(x = unname(c("nbrM" = "Hommes", "nbrF" = "Femmes")[label]), levels = c("Femmes", "Hommes")),
    direction = c("nbrM" = -1, "nbrF" = 1)[label],
    alpha = data
  )

g <- ggplot() +
  theme_classic() +
  geom_bar(
    data = filter(donnee, data=="Benin"),
    aes(x = age, y = nombre*direction, fill = sex, group = data, alpha = alpha),
    stat = "identity",
    width = 0.90
  ) +
  geom_bar(
    data = filter(donnee, data=="Classe"),
    aes(x = age, y = nombre*direction, fill = sex, group = data, alpha = alpha),
    stat = "identity",
    width = 0.45
  ) +
  geom_hline(yintercept = 0) +
  coord_flip() +
  scale_y_continuous(labels = function(x){paste0(abs(x), "%")}) +
  scale_alpha_manual(values = c(0.2, 1), breaks = c("Benin", "Classe")) +
  scale_fill_discrete(drop = FALSE) +
  labs(x = "Age", y = NULL, fill = "Sexe")

return(g)

}

leg <- get_legend(pyrclas(1))
p1<-pyrclas(1)+ theme(legend.position = "none")
p2<-pyrclas(2)+ theme(legend.position = "none")
p3<-pyrclas(3)+ theme(legend.position = "none")
p4<-pyrclas(4)+ theme(legend.position = "none")
p5<-pyrclas(5)+ theme(legend.position = "none")



plot_grid(p1, p2, p3, p4, p5, leg,labels = c("1", "2", "3", "4", "5",""), align = "hv",ncol=2)

```

- la **classe 1** : correspond à une population beaucoup plus jeune que la moyenne du pays avec un excédent de 0-9 ans et un déficit de 30 ans et plus. C'est la partie du pays où la transition démographique semble être la plus tardive
- la **classe 2** : présente également un profil de population jeune avec un excédent de 5-14 ans, mais se caractérise par une réduction relative des 0-4 ans qui témoigne soit d'une baisse de la fécondité, soit d'un exode rural des jeunes ménages avec enfants.
- la **classe 3** correspond au profil moyen du pays.
- la **classe 4** est caractérisée par un excédent de personnes âgées et un déficit à la fois de jeunes enfants et de jeunes adultes. Elle correspond à des zones de vieillissment relatif de la population, soit sous l'effet de l'exode rural, soit en raison d'une baisse de la fécondité.
- la **classe 5** est caractérise par une forte surreprésentation des jeunes adultes et des persones âgées, associée à un net déficit des enfants jeunes de 0 à 14 ans. Il s'agit vraisemblablement de zones urbaines caractérisées par une fécodité plus tardive et une meilleure espérance de vie.  

On peut visualiser la distribution de ces cinq classes sur une carte : 


```{r, echo=FALSE, fig.cap = "Distribution spatiale des classes (source : OCHA)"}

par(mfrow = c(1,1))


### Carte classique

adm2$clust<-cah$data.clust$clust

# set theme
mf_theme("candy")
# plot administrative status
mf_map(
  x = adm2, 
  var = "clust", 
  type = "typo",
  pal = c("red", "orange","yellow","green","blue"), 
  lwd = .5,
  leg_pos = "topright",
  leg_title = ""
)

# layout
mf_layout(title = "Carte géométrique",  
          scale = "FALSE",
          credits = paste0("Sources: OCHA, 2019\n",
                            "Ecole d'été CIST 2022"))




```




## Alphabetisation et langues (2013)


### Métadonnées 

Ce fichier qui est accessible sur HDX en suivant [ce lien](https://data.humdata.org/dataset/benin-languages) a été mis à disposition par l'organisation [Translators without borders](https://translatorswithoutborders.org/) mais l'analyse des métadonnées montre qu'il s'agit en fait de données extraites du recensement géénral de population du Bénin de 2013 :


> Created by Translators without Borders,  Uploaded on Jun-21, Version 1

>**Notes and caveats**

>  + All data is drawn from government survey results and is subject to any associated limitations or distortions present in the source data.
>  + Literacy was measured as the ability to read and write in any language.
Languages with population shares less than 0.01% or under 1,000 people (whichever is greater) have been aggregated into the “Other” field.
>  + All decimal values have been rounded to a maximum of 3 decimal places. As a result language shares may not total 100%.
>  + Empty values represent non-existent data and should not be treated as zero values.
Data is available under an Attribution NonCommercial ShareAlike 4.0 International license (CC BY NC SA 4.0)

>**Copyright and terms of use**

>  + You are free to share and adapt the data subject to requirements for attribution and non commercial use. 
>  + Any derivative work must be distributed under the same license as the original. Full terms at 
https://creativecommons.org/licenses/by nc sa/4.0/


### Préparation des données

Les fichiers fournies comportaient de petites erreurs ou des difficultés de formatage rendant compliquée leur importation dans R. Il a donc fallu les corriger un peu avant de les utiliser. Une fois cela effectué, on a vérifié que les données pouvaient se cartographie en effectuant une jointure avec le fichier administratif au niveau communal.  

**N.B.** nous avons retrouvé l'erreur  dans le code de la commune d'Adjara qui est noté *BJ0101* alors que le code exact est *BJ1001*. Nous avons donc reconstruit les fichiers en les harmonisant avec les fonds de carte. 




### Variables d'alphabétisation

Le fichier comporte tout d'abord un ensemble de variables concernant le niveau d'alphabétisation des hommes et des femmes de plus de 6 ans en 2013. Voici à titre indicatif les valeurs par département et pour l'ensemble du pays :  


```{r}
dep<-read.table("data/langues/ben_lang_adm1_correct.csv", sep=";",header =TRUE, dec=",")
dep<-dep[,c(1:2,77:82)]
kable(dep)
```

Ce tableau se prêtera particulièrement bien à des exercices d'initiation à la statistiques et la cartographie sous R puisqu'il comporte à la fois des stocks (population par sexe), des taux (% de population alphabétisée par sexe) et une possibilité de les combiner pour retrouver le nombre de personnes alphabétisée. Il s'inscrit par ailleurs pleinement dans la thématique des inégalités territoriales. 

On peut à titre d'exemple construire une cartographie du niveau d'alphabétisation des hommes et des femmes par département du Bénin en 2013 (carte choroplèthe) et superposer par dessus les effectifs correspondants d'hommes et de femmes alphabétisés. 



```{r, echo=FALSE, fig.cap = "Alphabétisation des hommes et femmes du Bénin par département en 2013 (source : RP Bénin 2013, via OCHA)"}

# calcul du nombre de pers. alphabétisées par sexe
dep$literacy_female_pop <- dep$literacy_female*dep$pop_female
dep$literacy_male_pop <- dep$literacy_male*dep$pop_male

# Chargement de la géométrie
map <- st_read("data/admin/ben_adm1.shp", quiet=TRUE)  %>% select(ADM1_CODE)     

# Jointure
mapdep<-merge(map,dep,by="ADM1_CODE")

par(mfrow = c(1,2))


mf_theme("darkula")
mapdep %>% 
  mf_map("literacy_female", 
         type = "choro",
          breaks = c(0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9),
         leg_title = "%", 
         leg_pos = "right",
         ) %>%
  mf_map("literacy_female_pop", 
         type = "prop",
         leg_title = "effectif", 
         leg_pos = "left",
         inches=0.1
         ) 

   mf_layout(title = "Femmes", 
          credits = "EE Cist 2022, Source : RP 2013",
          scale = FALSE,
          arrow = FALSE)

mf_theme("darkula")
mapdep %>% 
  mf_map("literacy_male", 
         breaks = c(0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9),
         type = "choro",
         leg_title = "%", 
         leg_pos = "right"
         ) %>%
  mf_map("literacy_male_pop", 
         type = "prop",
         leg_title = "effectif", 
         leg_pos = "left",
         inches=0.1
         ) 
   mf_layout(title = "Hommes", 
          credits = "EE Cist 2022, Source : RP 2013",
          scale = FALSE,
          arrow = FALSE)


```

On voit apparaître alors une assez forte corrrélation entre les deux distributions, même si les femmes sont moins alphabétisés que les hommes. Ce qui suggère un exercice d'apprentissage de la régression linéaire entre les deux variables.

```{r}
mod.reg <- lm(dep$literacy_female~dep$literacy_male)
#stargazer(mod.reg,type = "html")
ggplot(data = dep) + aes(x=100*literacy_male, y = 100*literacy_female, label = ADM1_NAME) +
                     geom_point(col="red") + 
                     geom_smooth(method="lm") +
                     geom_text(cex=3, nudge_y=2) +
                     scale_x_continuous("Taux d'alphabétisation des hommes (%)") +
                     scale_y_continuous("Taux d'alphabétisation des femmes (%)") +
                     ggtitle("Inégalités d'alphabétisation des départements du Benin par sexe",
                             subtitle = "Source : RP 2013 via OCHA")
```



Les résultats mettent en évidence le fait que l'alphabétisation des femmes au Bénin en 2013 est en moyenne inférieure de 20% à celle des hommes (le paramètre b de la régression est non significatif) et la relation est statistiquement très significative (r2  = 93 \%, p < 0.001). Il existe notamment des résidus c'est-à-dire des départements où la scolarisation des femmes estimée en fonction de celle des hommes est plus forte que prévue (*Alibori, Borgou, Littoral*) ou plus faible que prévue (*Plateau, Couffo, Mono*). 


## Prix de la nourriture sur les marchés (2002-2021)

### Métadonnées

Ce fichier qui est accessible sur HDX en suivant [ce lien](https://data.humdata.org/dataset/wfp-food-prices-for-benin) a été mis à disposition par  [World Food Programme](https://www.wfp.org/). Cette base qui semble avoir été interrompue présente l'avantage d'offrir une grande profondeur historique et une résolution spatialetrès précise puisque les prix sont localisés par marché et par semaine.

>This no longer updated dataset contains Global Food Prices data from the World Food Programme covering foods such as maize, rice, beans, fish, and sugar for 76 countries and some 1,500 markets. It is updated weekly but contains to a large extent monthly data. The data goes back as far as 1992 for a few countries, although many countries started reporting from 2003 or thereafter.


### Préparation des données

Le fichier contenant les coordonnées de latitude et de longitude des marchés, il peut théoriquement être cartographié facilement à l'aide d'un outil de cartographie dynamique tel que `mapview`. Mais il peut aussi faire l'objet de multiples agrégations spatiales, temporelles, par produit. Reste évidemment à en apprécier la qualité ...

Noter qu'il est nécessaire d'éliminer la seconde ligne du tableau sous excel pour pouvoir ensuite charger correctement le fichier. Il est également préférable de lire le fichier avec la fonction *fread()* du package `data.table` faut de quoi on peut avoir des problèmes d'encodage plus ou moins délicats à résoudre. 


```{r}
dt<-fread("data/foodprices/wfp_food_prices_ben.csv")
kable(head(dt))
```

On peut assez facilement spatialiser le fichier qui comporte en tout 51 marchés assez bien répartiis sur l'ensemble du pays comme le montre la carte ci-desous :


```{r}
loc<-dt %>% filter(duplicated(market)==FALSE) %>% select(c(2,3,4,5,6)) %>% arrange (admin1,admin2, market)
markets <- st_as_sf(loc, coords = c("longitude","latitude"))
st_crs(markets)<- 4326
#mapview(markets)


adm0<-st_read("data/admin/ben_adm0.shp",quiet = TRUE)
adm1<-st_read("data/admin/ben_adm1.shp",quiet = TRUE)
adm2<-st_read("data/admin/ben_adm2.shp", quiet = TRUE)

par(mar=c(0,0,0,0))
plot(adm2$geometry,col="gray90", border = "gray20",lwd=0.5)
plot(adm1$geometry,col=NA, border = "black",lwd=1, add=TRUE)
plot(adm0$geometry,col=NA, border = "black",lwd=2, add=TRUE)
plot(markets$geometry,col="red", bg="yellow",pch=21,add=TRUE,cex=0.7)
```

### Intérêt pédagogique 

Cette base de données **multidimensionelle** peut servir d'exemple pour de nombreux exercices d'apprentissage de la statistique et de la cartographie sous R. Le prix des produits alimnentaires dépend en effet :

- du type de produit (QUOI) ?
- de la date d'achat (QUAND) ?
- du lieu d'achat (OU ?)

Pour chacune des dimensions, on peut réaliser des procédures **d'agrégation** des valeurs observées ou **d'estimation** des valeurs manquantes. A titre d'exemple, on extrait de la base de donnée l'ensemble des lignes qui concernent le riz

```{r}
riz<- dt %>% filter(substr(commodity,1,4)=="Rice") %>% 
               select(when = date, 
                      where1 = admin1,
                      where2 = admin2,
                      where3 = market,
                      what = commodity,
                      cost = usdprice )
kable(head(riz))
```


On peut calculer le prix median du riz sur l'ensemble des points de sondage disponibles en fonction de la catégorie de riz : 

```{r}
tab<- riz %>% group_by(when, what) %>% summarize(median_cost=median(cost), nbobs = n())
ggplot(tab) + aes(x=when,y=median_cost, color=what, size=nbobs) + geom_point() 
```

Le graphique montre plusieurs choses :

- les données les plus complètes concernent le riz importé qui augmente fortement au moment de la crise de 2007-2008
- la spatialisation des données n'est pas vraiment possible avant 2015 voire 2018
- il y a de fortes différences de prix selon le type de riz


Effectuons maintenant un zoom sur le priz médian du riz importé en 2020-2021 par régions :

```{r}
tab <- riz %>% filter(when >=as.Date("2020-01-01"), what =="Rice (imported)") %>%
               group_by(when,where1) %>%
               summarize(median_cost=median(cost))
ggplot(tab) + aes(x=when,y=where1, fill=median_cost) +geom_tile() + 
  scale_fill_gradient(low="white", high = "red")
                        


```





=======
Le même modèle appliqué au niveau des communes permettrait une analyse plus fine des résultats à travers une carte des résidus. On pourrait aussi imaginer une analyse mutiscalaire croisant les écarts des communes à la moyenne du pays, de leur département et des communes voisines à l'aide du package `mta`. Bref, il s'agit sans nul doute d'un excellent exemple pédagogique pour l'école d'été CIST2022.



## Villages et localités vers 2015

Un autre dossier accessible en [cliquant ici](https://data.humdata.org/dataset/benin-settlements) concerne le peuplement, c'est-à-dire l'inventaire de toutes les localisations avec leur nom et leur position en latitude longitude. Il comporte 6306 entrées. Les fichiers sont datés de 2015. 

```{r, fig.width=5,fig.cap="Village et peuplement au Benin vers 2015 (Source : OCHA-ROWCA)"}
loc<-st_read("data/settlement/ben_plp_NGA.shp", quiet = TRUE)
par(mar=c(0,0,0,0))
plot(adm2$geometry,col="lightyellow", border = "gray20",lwd=0.5)
plot(loc$geometry,col="red",pch=16,cex=0.2, add=T)

```

A titre de vérification de la précision, nous effectuons une superposition sur le fonds de carte OpenStreetMap pour la commune de Ouidah (code BJ0304 ou BEN003004) ou aura lieu l'école d'été du CIST. En cliquant sur les points onpeut comparer leur nom avec celui des localités indiquées par OSM.

```{r, fig.width=5,fig.cap="Projection des données OCHA-ROWCA sur Open Street Map (commune de Ouidah"}
map<-adm2[adm2$admin2Pcod=="BJ0304",]
map<-st_transform(map,4326)

vil<-loc[loc$RowcaCode2=="BEN003004",]
vil<-st_transform(vil,4326)


map <- leaflet() %>% 
            addTiles() %>%
            setView(lat = 6.4, lng=2.1, zoom = 11) %>%
            addPolygons(data = map,
                        fill = FALSE,
                        color = "red",
                        weight = 2) %>%
             addMarkers(data = vil,
                        label = ~FULL_NAME_)

map
```

Il y a à l'évidence des décalages ... Et le contour de la commune lui-même ne semble pas coller exactement avec celui fourni par OSM. Il faudra vérifier laquelle des deux sources est erronée (à moins que ce ne soient les deux ?). Toutefois, la localisation semble rester approximativement juste ...




# Bibliographie {-}

<div id="refs"></div>


# Annexes {-}


## Infos session  {-}

```{r session_info, echo=FALSE}
kableExtra::kable_styling(kable(sessionRzine()[[1]], row.names = F))
kableExtra::kable_styling(kable(sessionRzine()[[2]], row.names = F))
```





## Citation {-}

```{r generateBibliography, echo=FALSE}

cat(readLines('cite.bib'), sep = '\n')

``` 

<br>

## Glossaire {- #endnotes}

```{js, echo=FALSE}

$(document).ready(function() {
  $('.footnotes ol').appendTo('#endnotes');
  $('.footnotes').remove();
});

```


